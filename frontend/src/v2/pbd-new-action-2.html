<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../shared-styles.html">
<link rel="import" href="pbd-object-select.html">
<link rel="import" href="pbd-world-state-select.html">

<dom-module id="pbd-new-action-2">
    <template>
        <style include="shared-styles"></style>
        <style>
            #content {
                padding: 2%;
            }
            #form {
                border: 1px solid;
                box-sizing: border-box;
                padding: 2%;
                padding-top: 0;
            }
            .button-visible {
                background: rgba(190, 241, 230, 0.603);                
            }
            #form div{
                display:inline-block;
            }
            #left {width: 60%;}
            #right {width: 39%;}
            img {
                max-width: 100%;
                max-height: 100%;
            }
            fieldset iron-icon {
                display: inline-block;
                vertical-align: top;
                margin-top: 5px;
            }
            .petit {
                font-size: 80%;
                margin-left: 20%;
                color:steelblue;
            }
            #detect {
                margin-top: 20px;
                float: right;
            }
            fieldset > p {
                display: inline-block;
            }
            #label2 {
                margin-left: 105px;
            }
            #next {
                float: right;
                margin: 10px;
            }
            paper-input {
                width: 40%;
                display: inline-block;
            }
        </style>
        <body class="fullbleed layout vertical">
            <paper-header-panel class="flex">
                <paper-toolbar slot="header">
                    <paper-button slot="top">Home</paper-button>
                    <paper-button slot="top">Actions menu</paper-button>
                    <paper-button slot="top">Problems menu</paper-button>
                    <paper-button slot="top">Help</paper-button>
                </paper-toolbar>

                <div id="content">
                    <h1 align="center">Create an Action</h1>

                    <div id="form">
                        <div id="left">
                            <paper-input label="Enter a name for the action"></paper-input>

                            <paper-button id="detect" class="button-visible" raised>Redetect world state</paper-button>

                            <p>The world types have been detected as shown on the right :</p>
                            
                            <fieldset>
                                <legend>Objects detected</legend>
                                <p>Instance name</p>
                                <p id="label2">Instance type</p>
                                <br>

                                <div id="listeObjet">
                                    <pbd-object-select id="selectObj1" on-delete="deleteObj" num="1"></pbd-object-select>
                                </div>

                                <br>
                                <paper-button noink class="petit" on-click="newObj">+ add new instance</paper-button>
                            </fieldset>

                            <fieldset>
                                <legend>Final world state</legend>
                                <div id="listeWorldState">
                                    <pbd-world-state-select id="selectPred-1" on-delete="deletePred" num="1"></pbd-world-state-select>
                                </div>
                                <paper-button noink class="petit" on-click="newPrecond">+ add new postcondition</paper-button>
                            </fieldset>
                        </div>
                        <div id="right">
                            <img src="https://scontent-mrs1-1.xx.fbcdn.net/v/t1.0-0/c0.0.960.347/s480x480/31934882_1832788050356834_1049582663024771072_n.jpg?_nc_cat=0&oh=45782e55428fe654fbb2bcded42496d7&oe=5B92D8F3" alt="image">
                        </div>
                    </div>
                    <paper-button id="back" raised class="button-visible">Back</paper-button>
                    <paper-button id="next" raised class="button-visible">Save action</paper-button>
                </div>
            </paper-header-panel>            
        </body>                  
    </template>
    <script>
        Polymer({
            is: 'pbd-new-action-2',

            properties: {
                actionName: {
                    type: String,
                    value: ''
                },
                nbObj: {
                    type: Number,
                    value: 1
                },
                nbPrecond: {
                    type:Number,
                    value: 1
                },
                // a remplacer si possible mais comment ?
                // tableau d'entier [1,2,3] allant jusqu'a nbPrecond, utilis√© pour dom-repeat qui veut un array et non un number
                listObj: {
                    type: Array,
                    value: [1]
                },
                listPrecond: {
                    type: Array,
                    value: [1]
                },
            },

            newPrecond: function() {
                this.nbPrecond++;
                this.push('listPrecond',this.nbPrecond);
                // On rajoute dynamiquement l'objet
                var dynamicSelect = document.createElement("pbd-world-state-select");
                dynamicSelect.num = this.nbPrecond;
                var newId = "selectPrecond" + this.nbPrecond;
                dynamicSelect.id = newId;
                dynamicSelect.addEventListener('delete',this.deletePred);
                Polymer.dom(this.root).querySelector("#listeWorldState").appendChild(dynamicSelect);
            },
            newObj: function() {
                this.nbObj++;
                this.push('listObj',this.nbObj);
                // On rajoute dynamiquement l'objet
                var dynamicSelect = document.createElement("pbd-object-select");
                dynamicSelect.num = this.nbObj;
                var newId = "selectObj" + this.nbObj;
                dynamicSelect.id = newId;
                dynamicSelect.addEventListener('delete',this.deleteObj);
                Polymer.dom(this.root).querySelector("#listeObjet").appendChild(dynamicSelect);
            },
            deleteObj: function(e) {
                var name = "selectObj"+e.detail.id;
                this.$.name.hello();
            },
            deletePred: function(e) {
                // TODO
            }
        });
    </script>
</dom-module>